<%- include('../layouts/user/header.ejs') -%>

    <!-- preloader -->

    <div class="has-breadcrumb-bg mb-120">

        <!-- <div class="breadcrumb-content"
                        style="flex-direction: column;">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb p-0 m-0">
                                <li class="breadcrumb-item"><a
                                        href="home">Home</a></li>
                                <li class="breadcrumb-item active"
                                    aria-current="page">Cart</li>
                            </ol>
                        </nav>

                        <h2 class="cart-title mt-40">Cart</h2>
                    </div> -->
        <% if(products.length !=0) {%>
            <div class="shop-body mb-90">
                <div class="container-fluid">
                    <div class="shop-wrapper">
                        <div class="row">
                            <div class="col-xl-3 hidden-xl">
                                <!-- widget -->

                                <!-- filter area  -->

                                <div class="widget">
                                    <h4 class="mb-30">Product Categories</h4>
                                    <div class="category-list">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value id="category1">
                                            <label class="form-check-label" for="category1">Accessories (0)</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value id="category2">
                                            <label class="form-check-label" for="category2">Char & Table
                                                (10)</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value id="category3">
                                            <label class="form-check-label" for="category3">Handbag (10)</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value id="category4">
                                            <label class="form-check-label" for="category4">Kids (15)</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="widget mt-50">
                                    <h4 class="mb-30">Filter By Price</h4>
                                    <form id="priceFilterForm" action="/filterProduct" method="get">
                                        <div class="price-filter">
                                            <div class="filter-options">
                                                <label>
                                                    <input type="checkbox" class="price-checkbox" value="low-to-high"
                                                        style="color: black;"> Low to
                                                    High
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" class="price-checkbox" value="high-to-low"
                                                        style="color: black;"> High to
                                                    Low
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" class="price-checkbox" value="all"
                                                        style="color: black;"> All Price
                                                    Ranges
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" class="price-checkbox" value="0-50"
                                                        style="color: black;"> $0 - $50
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" class="price-checkbox" value="51-100"
                                                        style="color: black;"> $51 -
                                                    $100
                                                </label>
                                                <br>
                                                <label>
                                                    <input type="checkbox" class="price-checkbox" value="101-200"
                                                        style="color: black;"> $101 -
                                                    $200
                                                </label>
                                                <!-- Add more predefined price ranges as needed -->
                                            </div>
                                            <div class="filter-form-submit mt-35">
                                                <button type="button" id="applyPriceFilter">Apply
                                                    Filter</button>
                                            </div>

                                        </div>
                                    </form>
                                </div>

                                <!-- <div class="widget mt-50">
                            <h4 class="mb-30">Filter By Color</h4>
                            <ul class="color-list">
                                <li style="background-color: #000;"></li>
                                <li style="background-color: #1E73BE;"></li>
                                <li style="background-color: #FFD700;"></li>
                                <li style="background-color: #C9C9C9;"></li>
                                <li style="background-color: #008000;"></li>
                                <li style="background-color: #FFFF00;"></li>
                                <li style="background-color: #FFFFFF;"></li>
                                <li style="background-color: #DD3333;"></li>
                            </ul>
                        </div> -->
                                <!-- <div class="widget mt-50">
                            <h4 class="mb-30">Filter By Size</h4>
                            <div class="size-link">
                                <a href="shop2.html">3xl</a>
                                <a href="shop2.html">l</a>
                                <a href="shop2.html">m</a>
                                <a href="shop2.html">s</a>
                                <a href="shop2.html">xl</a>
                                <a href="shop2.html">xxl</a>
                            </div>
                        </div> -->
                                <!-- <div class="widget mt-50">
                            <h4 class="mb-30">Featured</h4>
                            <div class="post-box">
                                <ul>
                                    <li>
                                        <div class="post-img">
                                            <img src="img/product/1.jpg" class="w-100" alt="">
                                        </div>
                                        <div class="post-img-desc">
                                            <a href="single-product-4.html">Capitalize on low hanging fruit to</a>
                                            <div class="price">$250.00</div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="post-img">
                                            <img src="img/product/2.jpg" class="w-100" alt="">
                                        </div>
                                        <div class="post-img-desc">
                                            <a href="single-product-4.html">
                                                Tassels pendant earringso</a>
                                            <div class="price">$30 - $334</div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="post-img">
                                            <img src="img/product/3.jpg" class="w-100" alt="">
                                        </div>
                                        <div class="post-img-desc">
                                            <a href="single-product-4.html">
                                                Tassels pendant earringso</a>
                                            <div class="price">$30 - $334</div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div> -->
                                <div class="widget mt-50">
                                    <h4 class="mb-30">Popular Tags</h4>
                                    <div class="category-list">
                                        <ul>
                                            <li><a >HOODIE</a></li>
                                            <li><a href="shop2.html">Clothing</a></li>
                                            <li><a href="shop2.html">fashion</a></li>
                                            <li><a href="shop2.html">Fly</a></li>
                                            <li><a href="shop2.html">Glasses</a></li>
                                            <li><a href="shop2.html">men</a></li>
                                            <li><a href="shop2.html">Product</a></li>
                                            <li><a href="shop2.html">version</a></li>
                                            <li><a href="shop2.html">women</a></li>
                                        </ul>
                                    </div>

                                </div>
                            </div>

                            <!-- end filter herre  -->

                            <!-- /. widget -->
                            <div class="col-xl-9">
                                <div class="filter-heading">
                                    <div class="row">
                                        <div class="col-xl-4 col-lg-4 col-md-4 col-12">
                                            <div class="filter-shown-item">
                                                <p class="mb-0">
                                                    Showing <span>
                                                        <%= (currentPage - 1) * limit + 1 %>
                                                    </span>–
                                                    <span>
                                                        <%= Math.min(currentPage * limit, totalProducts) %>
                                                    </span>
                                                    of <span class="total_count">
                                                        <%= totalProducts %>
                                                    </span> results
                                                </p>
                                                <p class="mb-0">
                                                    Page <span>
                                                        <%= currentPage %>
                                                    </span>
                                                    of <span>
                                                        <%= totalPages %>
                                                    </span>
                                                </p>
                                            </div>
                                        </div>

                                        <!------------------------------------------------------------- hey --------------------------------------------------->
                                        <div
                                            class="col-xl-4 col-lg-4 col-md-4 col-12 d-flex justify-content-end position-static">
                                            <div class="sorting d-inline-block">
                                                <select name="sort" id="shop-sort">
                                                    <option value="default">Default
                                                        sorting</option>
                                                    <option value="default">Short by
                                                        popularity</option>
                                                    <option value="default">Sort by
                                                        average rating</option>
                                                    <option value="default">Sort by
                                                        latest</option>
                                                    <option value="default">Sort by
                                                        price: low to high</option>
                                                    <option value="default">Sort by
                                                        price: high to low</option>
                                                </select>
                                            </div>

                                        </div>
                                        <!------------------------------------ filtr in head -------------------------------------------- -->
                                    </div>
                                </div>

                                <!-- /. filter heading -->
                                <div class="filter-content">
                                    <div class="tab-content">

                                        <div class="product-wrapper mt-55">
                                            <div class="row">
                                                <% products.forEach(product=> { %>
                                                    <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6 col-12">
                                                        <div class="product-box mb-40">
                                                            <div class="product-box-wrapper">
                                                                <div class="product-img">
                                                                    <img src="/products/crops/<%= product.images.image1 %>"
                                                                        class="w-100" alt>
                                                                    <a href="/product?id=<%= product._id %>"
                                                                        class="d-block">
                                                                        <div class="second-img">
                                                                            <img src="/products/crops/<%= product.images.image2 %>"
                                                                                alt class="w-100">
                                                                        </div>
                                                                    </a>
                                                                    <a href="javascript:void(0)"
                                                                        class="product-img-link quick-view-1 text-capitalize">Quick
                                                                        view</a>
                                                                </div>

                                                                <div class="product-desc pb-20">
                                                                    <div class="product-desc-top">
                                                                        <div class="categories">
                                                                            <a href="shop2.html"
                                                                                class="product-category"><span>
                                                                                    <%= product.category %>
                                                                                </span></a>
                                                                        </div>
                                                                        <a href="wishlist.html"
                                                                            class="wishlist float-right"><span><i
                                                                                    class="fal fa-heart"></i></span></a>
                                                                    </div>
                                                                    <a href="/product" class="product-title">
                                                                        <%= product.name %>
                                                                    </a>
                                                                    <div class="price-switcher">
                                                                        <span class="price switcher-item">₹<%=
                                                                                product.price %>
                                                                        </span>
                                                                        <a onclick="addToCart('<%= product._id %>')"
                                                                            class="add-cart text-capitalize switcher-item"
                                                                            style="cursor: pointer;">+
                                                                            Add to Cart</a>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <% }); %>

                                                        <!-- 
                                                <div class="text-center mt-20">
                                                    <a href="shop.html" class="load-more">LOAD MORE...</a>
                                                </div> -->
                                            </div>

                                        </div>
                                        <nav aria-label="Page navigation">
                                            <ul class="pagination justify-content-center">
                                                <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                                    <a class="page-link" href="/shop?page=<%= currentPage - 1 %>"
                                                        aria-label="Previous">
                                                        <span aria-hidden="true">&laquo;</span>
                                                    </a>
                                                </li>

                                                <% for (let i=1; i <=totalPages; i++) { %>
                                                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                                        <a class="page-link" href="/shop?page=<%= i %>">
                                                            <%= i %>
                                                        </a>
                                                    </li>
                                                    <% } %>

                                                        <li
                                                            class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                                            <a class="page-link"
                                                                href="/shop?page=<%= currentPage + 1 %>"
                                                                aria-label="Next">
                                                                <span aria-hidden="true">&raquo;</span>
                                                            </a>
                                                        </li>
                                            </ul>
                                        </nav>
                                    </div>

                                    <!-- this i want take  -->

                                </div>
                            </div>
                            <!-- /. filter content -->
                        </div>
                        <!-- /. shop products -->
                    </div>
                </div>
            </div>
            <% } %>

    </div>



    <script>
        // function addToCart(productId) {

        //     $.ajax({
        //         url: "/addToCart",
        //         method: "post",
        //         data: {
        //             id: productId,
        //         },
        //         success: (response) => {
        //             if (response.login == true) {
        //                 swal
        //                     .fire({
        //                         icon: "warning",
        //                         title: "Please Login",
        //                         confirmButtonColor: "#3085d6",
        //                         confirmButtonText: "Login",
        //                         showCancelButton: true,
        //                         cancelButtonColor: "#d33",
        //                         text: response.message,
        //                     })
        //                     .then((result) => {
        //                         if (result.isConfirmed) {
        //                             window.location.href = "/loadLogin";
        //                         }
        //                     });
        //             } else if (response.success) {
        //                 swal.fire({
        //                     position: "center",
        //                     icon: "success",
        //                     title: "Product added to cart",
        //                     showConfirmButton: false,
        //                     timer: 1500,
        //                 });
        //                 $("#cartDiv").load("/ #cartDiv");
        //             } else {
        //                 swal.fire({
        //                     icon: "error",
        //                     title: "Sorry ! Out of stock. ",
        //                     text: response.message,
        //                 });
        //             }
        //         },
        //     });
        // }


        function addToCart(productId, count = 1) {
            $.ajax({
                url: "/addToCart",
                method: "post",
                data: {
                    id: productId,
                    count: count,
                },
                success: (response) => {
                    if (response.login == true) {
                        // Handle login logic if needed
                    } else if (response.success) {
                        if (response.newProduct) {
                            swal.fire({
                                position: "center",
                                icon: "success",
                                title: "Product added to cart",
                                showConfirmButton: false,
                                timer: 1500,
                            });
                        } else {
                            swal.fire({
                                position: "center",
                                icon: "info",
                                title: "Product already in the cart. Increasing quantity.",
                                showConfirmButton: false,
                                timer: 2000,
                            });
                        }
                        $("#cartDiv").load("/ #cartDiv");
                    } else {
                        swal.fire({
                            icon: "error",
                            title: "Sorry! Out of stock.",
                            text: response.message,
                        });
                    }
                },
            });
        }

    </script>



    <%- include('../layouts/user/footer.ejs') -%>